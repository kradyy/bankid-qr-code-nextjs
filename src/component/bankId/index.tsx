import useBankId from "@/hooks/useBankId";
import Button from "@/components/elements/Button";
import React, { useContext, useEffect, useMemo, useReducer } from "react";
import { BankIdContext } from "./BankIdContext";
import AuthenticationView from "./methods/AuthenticationView";

const identificationDebug = {
  orderRef: "9218c98e-15d6-4668-ad25-5927a08f2590",
  status: "complete",
  completionData: {
    user: {
      personalNumber: "198912072454",
      name: "Chris Johansson",
      givenName: "Chris",
      surname: "Johansson",
    },
    device: {
      ipAddress: "80.252.216.254",
      uhi: "SUqES1XExGZ/kNk+N9DfVL/VhKw=",
    },
    bankIdIssueDate: "2024-08-06Z",
    signature:
      "PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+PFNpZ25hdHVyZSB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnIyI+PFNpZ25lZEluZm8geG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyMiPjxDYW5vbmljYWxpemF0aW9uTWV0aG9kIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvVFIvMjAwMS9SRUMteG1sLWMxNG4tMjAwMTAzMTUiPjwvQ2Fub25pY2FsaXphdGlvbk1ldGhvZD48U2lnbmF0dXJlTWV0aG9kIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS8wNC94bWxkc2lnLW1vcmUjcnNhLXNoYTI1NiI+PC9TaWduYXR1cmVNZXRob2Q+PFJlZmVyZW5jZSBUeXBlPSJodHRwOi8vd3d3LmJhbmtpZC5jb20vc2lnbmF0dXJlL3YxLjAuMC90eXBlcyIgVVJJPSIjYmlkU2lnbmVkRGF0YSI+PFRyYW5zZm9ybXM+PFRyYW5zZm9ybSBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnL1RSLzIwMDEvUkVDLXhtbC1jMTRuLTIwMDEwMzE1Ij48L1RyYW5zZm9ybT48L1RyYW5zZm9ybXM+PERpZ2VzdE1ldGhvZCBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvMDQveG1sZW5jI3NoYTI1NiI+PC9EaWdlc3RNZXRob2Q+PERpZ2VzdFZhbHVlPnlQN0l4TUxZQkxOSFRndXgyK0IvN05WOFJraHVWTnJHa2h3QzM0Qy96dFk9PC9EaWdlc3RWYWx1ZT48L1JlZmVyZW5jZT48UmVmZXJlbmNlIFVSST0iI2JpZEtleUluZm8iPjxUcmFuc2Zvcm1zPjxUcmFuc2Zvcm0gQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy9UUi8yMDAxL1JFQy14bWwtYzE0bi0yMDAxMDMxNSI+PC9UcmFuc2Zvcm0+PC9UcmFuc2Zvcm1zPjxEaWdlc3RNZXRob2QgQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzA0L3htbGVuYyNzaGEyNTYiPjwvRGlnZXN0TWV0aG9kPjxEaWdlc3RWYWx1ZT5oY3J5WGVSYm0yYStHajdoNm1QWVJTaW1HLzZLQXh0Wnd3a2tmUWlobkNzPTwvRGlnZXN0VmFsdWU+PC9SZWZlcmVuY2U+PC9TaWduZWRJbmZvPjxTaWduYXR1cmVWYWx1ZT5ZdWVrOWxsVkgwYTZtT2xxUE0yNnp2SGdNZ1RyVUJRYTkxb1p5ZS9JVWt2WXVPZWxsb3NtZ05FNUpOcVlYaTFZRDJlVVZnNDZhenhBRE9idzdGeDFxbCt5bkFVYW5QaUhONVpYZXlxLzV2OHJ1M3o4WWczUmhPNUZ6dVIxQi8rREtKUmVEeWEzNkVjZFdXTnBtd2x6ZkxIRzhMYlgrYUFFWSs1L0dERmR1bFJkWW1sQ01vVEhJSnJ0ZHU5ZE40YnMxVWU4RjJDOWJ0WXUyUDcraVVDSGs5NWF3UGhaTEx1eFFNTXJoUVNhMThuV2hFMFcxTlk3TlRKNjJlTFVwMDZJSDE3N3Z2YXdQMTIwTEJhN3g0aERpUm5pV01vRC9maTZWZmVEYnN6WHNpNHdLSWsydXo5MnQ1SGhiK1FBVzlueUNETC9wOXBIWlgvWFRIUmVKcUJORHc9PTwvU2lnbmF0dXJlVmFsdWU+PEtleUluZm8geG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyMiIElkPSJiaWRLZXlJbmZvIj48WDUwOURhdGE+PFg1MDlDZXJ0aWZpY2F0ZT5NSUlGV1RDQ0EwR2dBd0lCQWdJSUZNMVZCNmNHaTVJd0RRWUpLb1pJaHZjTkFRRUxCUUF3ZURFTE1Ba0dBMVVFQmhNQ1UwVXhIVEFiQmdOVkJBb01GRlJsYzNSaVlXNXJJRUVnUVVJZ0tIQjFZbXdwTVJVd0V3WURWUVFGRXd3eE1URXhNVEV4TVRFeE1URXhNekF4QmdOVkJBTU1LbFJsYzNSaVlXNXJJRUVnUTNWemRHOXRaWElnUTBFeklIWXhJR1p2Y2lCQ1lXNXJTVVFnVkdWemREQWVGdzB5TkRBNE1EVXlNakF3TURCYUZ3MHlOVEE0TURZeU1UVTVOVGxhTUlHNk1Rc3dDUVlEVlFRR0V3SlRSVEVkTUJzR0ExVUVDZ3dVVkdWemRHSmhibXNnUVNCQlFpQW9jSFZpYkNreEVqQVFCZ05WQkFRTUNVcHZhR0Z1YzNOdmJqRU9NQXdHQTFVRUtnd0ZRMmh5YVhNeEZUQVRCZ05WQkFVVERERTVPRGt4TWpBM01qUTFOREUzTURVR0ExVUVLUXd1S0RJME1EZ3dOaUF4TVM0eE1Ta2dRMmh5YVhNZ1NtOW9ZVzV6YzI5dUlDMGdUVzlpYVd4MElFSmhibXRKUkRFWU1CWUdBMVVFQXd3UFEyaHlhWE1nU205b1lXNXpjMjl1TUlJQklqQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FROEFNSUlCQ2dLQ0FRRUF3cTBmdUNneFFCdjBveXg0aktOenE4Y2F4QnlUV3JwY2RTQlA0UlBoMUQxelZNd2o5OU1Ob0F1a3R5Y1NRNEZPMnpxMjcxdndVL0dCR1hBeFZYYmE5MjlGZHJoalhhbXdSUU9YYzBVNU1LMkY4eGxIbCtUblk5aWMwK1lvZjBjRjNmYndOTVhyOW01WWhCOHcvWWRQeDRRWWV0Y2Q5MnkvL1FBdDRxdVB6b2lmK3VkVHZ4dE5KdFg3bWNHSlk2bkdUQUwxdUNxQnFEOXdvc1lMNEQxT3p5YzZ1NUJyNU5jT1M1czJQcUZ2RDZLWHFXSW82VnVrV1U3bXBaakdoUkNLbnJReVJTd2tkQk5ESzI0Q3lEeTY0YUhZU3RVQmthTXp5RUJPa0krQkhyNkpqb05ZSEJ4Zk9pbUlKMk9UVGFBdWJSanNzYWRwK2d2SE1lVVl0Y0FTeXdJREFRQUJvNEdqTUlHZ01Ec0dDQ3NHQVFVRkJ3RUJCQzh3TFRBckJnZ3JCZ0VGQlFjd0FZWWZhSFIwY0RvdkwzUmxjM1F1Y21WMmIyTmhkR2x2Ym5OMFlYUjFjeTV6WlRBUkJnTlZIU0FFQ2pBSU1BWUdCQ29EQkJrd0RnWURWUjBQQVFIL0JBUURBZ2VBTUI4R0ExVWRJd1FZTUJhQUZGS1NEaUZ1NmlLbDJwWEhOK2VLVFByekVLNzdNQjBHQTFVZERnUVdCQlRFMDRjbHRtYUJIdHErQWJ0SS8zUUtnakp6cVRBTkJna3Foa2lHOXcwQkFRc0ZBQU9DQWdFQWVKZWFENlZaRnRNVVk5VmNpWWtsclZuVXpKT2YvM0JRemRBVW0wZFdOdjh5YWJPRHZ0eFliMW1NWEF0YVNOSHBzKzd5Mi9vZVpMWVdxb2JvNzJVRER2MmF4OEV2Y3J5QXRqY053aDJpbWxHRkJUOEZZNHpIZTBMYjBWZ05NNUsrV1pob1ZBZ3NjRTdzZGdwem5ObWVpdExVQXNjTE5JOUlTaEk3Nmt2U1NGNGFNT2F0S3lreTdmMWRtd21tSVh0Zzd6OVFFZzBKbWJlM2dGOGpVdFR2NDlwS3JQVnIwMTBXc1JSV2dvSitVMS9iVkEwbnJwVHpEbXVEcW83bXBkZU1aQjVtUDY4R0pJemd6R1RaZmxuR0p4VVhDQnp2OXJpVHlvenhHOXM2K2I3SnE5SVo4ODg0YVdWaXlLVThFSXVKT0gzSC9yeWV6TDRjVkpST291Szk5RlJHT1lDN2ozdExvUTBxRDdESEVXS0trZGV0eFRLS3lNT0lTYnJQUWxUditpMzZwV3JUZk9GQ04xejhwZHlMSTNMazlodFJuNEptNGwrcDl0cm14dDRTc29FazJYYVp6Q0JzNXJqcHdvbFVvREpkamVkMkNMZmhRSUJBUnhXNEhaOWVNZHBZMXRUQkhPb2tPbG14L20rcW9jd0kybFd4N20yNWsyYzBUVjl2WGI2a0QxNmlqbEFnNGVXaGtJQTE4K3NQb1BMS0tjaUp0bDUxMGIyY2hKUVhrMzlWOGZ3SGlTS2MzV3R4S1UraUlOMjRSZytjVU1JNGxZNFU0bjZQSENiayt1MjBRcG1XM0NSRFRqRll6V0VLMUFmdWtUVDRzbnc1UDhvYUF0UlRqdnF4azlyOGQrMWVXckFFeVQyL2RVTWFCZFVrd2ZadTkwSnZuRjh2L1Z3PTwvWDUwOUNlcnRpZmljYXRlPjxYNTA5Q2VydGlmaWNhdGU+TUlJRjNqQ0NBOGFnQXdJQkFnSUlEbkI0MkdVbEd2RXdEUVlKS29aSWh2Y05BUUVOQlFBd2JqRUxNQWtHQTFVRUJoTUNVMFV4SFRBYkJnTlZCQW9NRkZSbGMzUmlZVzVySUVFZ1FVSWdLSEIxWW13cE1SVXdFd1lEVlFRRkV3d3hNVEV4TVRFeE1URXhNVEV4S1RBbkJnTlZCQU1NSUZSbGMzUmlZVzVySUVFZ1EwRWdkakVnWm05eUlFSmhibXRKUkNCVVpYTjBNQjRYRFRFeE1Ea3lNakUwTXpNeU0xb1hEVE0wTVRJd01URTBNek15TTFvd2VERUxNQWtHQTFVRUJoTUNVMFV4SFRBYkJnTlZCQW9NRkZSbGMzUmlZVzVySUVFZ1FVSWdLSEIxWW13cE1SVXdFd1lEVlFRRkV3d3hNVEV4TVRFeE1URXhNVEV4TXpBeEJnTlZCQU1NS2xSbGMzUmlZVzVySUVFZ1EzVnpkRzl0WlhJZ1EwRXpJSFl4SUdadmNpQkNZVzVyU1VRZ1ZHVnpkRENDQWlJd0RRWUpLb1pJaHZjTkFRRUJCUUFEZ2dJUEFEQ0NBZ29DZ2dJQkFKbzAzS01KMS9meDk0T3NPYm9PeE1CcW43cGdqY3B2dFI3WEZkM0hjdzh6M0ZHZWFSNUVyc1lLaEx5MHB5QlRqMTU4dHM2ck8rLzBWMm9Od1VEdmY2aDBaQ3VwYmVQWExiZTlnNENwNm55QWx6OHNEV1lkb2hMV21aV2RmdDRCS2VMbDgxRWMyRVpoY1NoM0wxcm0vOEh1VzE5V1lveDZVcGU2TzZqeDVQOFUyTUE5VUN6MXlkMXFma1luZUdVd2hMNkwrZDdvQ3d4Uk5MbTJOZzNwT29jV1lpbXoxS3NvT2l4Ulc1QzJYcWpSV3VVYWw4YWh4dHArL25sOUNxcE1tSjRYOTh1SWR0SDhQT1hqbzBxYXREbVFhNkRBSGhFQTFYbzB1UUxzaURWS1dhS1o0cm1QM05vM09KYkxpV0RjL0F5V1I5VnZqQWQ3bU9QK2dTYkRTYlQrRWFnQ20yVmF3VjNmQUNGTldPaXVaOUNDOGgxa3Y5SEJyWThnOHN0TEEybFU3M05qcUtXU2VPYzhuUnV6RVNQUlM2aEM2SjEzYWJCdDkyd2xQWHBRN01CUXlVaVlPbFZ5OGZra01nWWFGYUdSY0pPTFFYMElINTFQUGRvY3FudVR3cWRNOU14M2VkOWI0V0h2eTZFT0tleHhxL04rT0JCL21iVll0MTh3K3A3SlppZUxrRWROc1FxZUVDVWxMOGxmNjlvN2ZwZ2QyZ3JMaTYyS1BlU0VmUjIrSVZNSHhRTitVcEhpakUwVlBZWWNDWTlsbVVkRVZzeGtzd01OQzd5RklwNEozdFhqdzk0Mi82NW55alJheW1YZHNiOWlhL0JkUGlnbTN3OWFyY2g0UlA4S0pKRjZ1eldNNHJqcGtsaHAxNEc5Y3lLVGQyY1RETE5ycVlueEFnTUJBQUdqZGpCME1CMEdBMVVkRGdRV0JCUlNrZzRoYnVvaXBkcVZ4emZuaWt6Njh4Q3UrekFQQmdOVkhSTUJBZjhFQlRBREFRSC9NQjhHQTFVZEl3UVlNQmFBRktQeWVIa2RLMFdLeWVIS2xRbmxubS9PeTA3Rk1CRUdBMVVkSUFRS01BZ3dCZ1lFS2dNRUdUQU9CZ05WSFE4QkFmOEVCQU1DQVFZd0RRWUpLb1pJaHZjTkFRRU5CUUFEZ2dJQkFESEhVUGtuTGtWVnlEV3dONC90bXNkcDdWazBLaitNRjRqYy91MnNVRVpiSFJqbW1rSU9xUFI2bDlBcFBwQ1JhV3V1dlpGdGJDdXBlNVh2a0NuL1FFREtGSkxjdG1WOFFlSVk1dlZzQjRsOW9LbE0rbHp6b3VwWEliY1hmN0ZVdHZOV1E2Z3A0eTRicGVuYzRoNWpKNGJQOXVveFZ2Q3JqSkJwQU5ITWU0ekxhYjBZS3BOU2FZcGpmWTgxSHVycVl2c2xWSkhxZmUwbFdMMWlIbzNyd1d3TzUrL2lmUEE0Z0w2dGhTSERGcTNzbGs4VFlORGRhNkRGcjZsTTE5cDBuMVAxeUdpSHcybmZoOFlCWGo1Z0J1dEFqSUl5NzB3N1M2ODRpenNLL1l5QlUwaGxxaWhsZXdWYVpYMkVFY1NkMHFlZDRJOEd5TmtpYzVPbExUcnE3NkJ1RWk1TlNhUjRXdHRCOVZKSW1TZGZiVTIrNFpNeXU1SW9mYlYreFljR1g4T0xpQTQ2MjkxRGdsOGxYVVlxOWFBeGZiNkc1WHhXNkNEODMxWk9Fcyt2b3NWZ3Q1TEIxdk9GdFFxUjhxOWZkcGM1b0kvVnZISkhya1VmNEZCakJ3OWNWTElrQ2E0K2svV2ErUEdWTWF4ekJsaEd1Rjdudk9KS3F6MGtFMkVyWTRJWE1tTTNnOUxHRFBIc3pwa25hWEVldG9Rdk45TnJTdU1wUk9SQ1dVN2dTaWQzYzdYenZZMG5OQmx3NSs0WFhhalVSbC8wY0NyRG9EVVc4NSszRUU5ZnduYVp6eGRrNk1zd05VNkRVVk51dWdwM1ptdFBnUHRCMGI4V3FhbngzaDkraTZ1UTA0Q1ZIVmV5anNRbUNncHhzbDFOWWNLdlA3S0ZzOVJNZENIRjwvWDUwOUNlcnRpZmljYXRlPjxYNTA5Q2VydGlmaWNhdGU+TUlJRjB6Q0NBN3VnQXdJQkFnSUlVWW1mZHRxdHk4MHdEUVlKS29aSWh2Y05BUUVOQlFBd2JURWtNQ0lHQTFVRUNnd2JSbWx1WVc1emFXVnNiQ0JKUkMxVVpXdHVhV3NnUWtsRUlFRkNNUjh3SFFZRFZRUUxEQlpDWVc1clNVUWdUV1Z0WW1WeUlFSmhibXR6SUVOQk1TUXdJZ1lEVlFRRERCdFVaWE4wSUVKaGJtdEpSQ0JTYjI5MElFTkJJSFl4SUZSbGMzUXdIaGNOTVRFd09USXlNVFF4TlRBeldoY05NelF4TWpNeE1UUXdNVE16V2pCdU1Rc3dDUVlEVlFRR0V3SlRSVEVkTUJzR0ExVUVDZ3dVVkdWemRHSmhibXNnUVNCQlFpQW9jSFZpYkNreEZUQVRCZ05WQkFVVERERXhNVEV4TVRFeE1URXhNVEVwTUNjR0ExVUVBd3dnVkdWemRHSmhibXNnUVNCRFFTQjJNU0JtYjNJZ1FtRnVhMGxFSUZSbGMzUXdnZ0lpTUEwR0NTcUdTSWIzRFFFQkFRVUFBNElDRHdBd2dnSUtBb0lDQVFDVHFVN3V4azVRemJYUzZBclhJR1RXTmVaWHo2NWJ6ZGdveGI3OUx2WWgvcDdrY0syNW1BMnR6R3BPM1FTMWVLSkp1ODRHOVVOem00bU1sNmNuZ25YY2p4RVRZaUVxdGlqckE1bWZ6ODY1L1g2VWdPcFg3RGtvdVE4ZDVlRHloSjQ5VXJEcWxyZ29WTXgzMjJrTTBTWjRoZVZlWDgzZTFJU0ZpeXhxWkJLeGgyNXlLWUVaQTRFeklyRGoydGk4Q1JyV1BIQ1RXYUlGcGNkNVR5TWhwVVRQbjREendQaFBHV01STnhnT0FlUDRCU0RCN1I2YXo0cm94N1RQa2Qyc1dHMU9Eai8wSVJQaEpTMWRRMUI3UWlOSFk1OFJqbk5UaEVRS3dkV1dNUE1LUHRoU2QrR0VqTDlHRGFmWXhPc0lyS0ZZd2xZTkJXM0M1bWJlM1QrM2orQXhqNlcySGJnbUpYUEdJdEx1Y3hZMWtQd1Q5TDd1NW5JeGFST21oMXVUd1lxcjlwdUdxNnNvSm5nZ0VTM0s0UEloTTZrYW12bkNDUFhvcVdDQ3J1U0VQVmd5RVpFaTBzaHkrODFRc2ViMWdjOXJZZ1ZyRW5MQk9JeU1xYVR0RXhhRnByWWJ2MWYvQXdXdGpGVWkyWGlTZE44YU1wK2txYmkrMXRLSlVVUExDK0NyZHU5ZkZvLzhsc2xTZGV3K1NuUFZGZVZ6NUNPS2J0NkdURTR4Y0plUnpXNXdRMHc3YityR0xXaEp2d1JKc1M1R1h2cWEzTGc4RXlXaUxKc3d1VEZhRXdQVUR2WkJ2eUZaRVplcnRLZ1piUll2ZXpvOS9ncnd5Qittb3JWckxyeXU5Y2hZRVl3RTU1MHV6eUt0elhVenlnVjhGcFhlOURwbXBPU2ZHTUFVUlFJREFRQUJvM1l3ZERBZEJnTlZIUTRFRmdRVW8vSjRlUjByUllySjRjcVZDZVdlYjg3TFRzVXdEd1lEVlIwVEFRSC9CQVV3QXdFQi96QWZCZ05WSFNNRUdEQVdnQlJLOTZOcUNOb0lPQmNaVXlqSTJxYldOTmhhdWpBUkJnTlZIU0FFQ2pBSU1BWUdCQ29EQkFVd0RnWURWUjBQQVFIL0JBUURBZ0VHTUEwR0NTcUdTSWIzRFFFQkRRVUFBNElDQVFEUDFEb3hqRWpleUcyN3hlYWkrbXB4eEpvcUIxUkRWVEVZODZSZE55bHVVS1FPSWJmS0pNbVgrRFg0dlR1VVFTMzUzOXh6SEt3cGo2Z2sraVpWakYxVW9KdEdwK3F1cmpqYXJPaDQ0cysrczB5V0tpS3JKQkVsb0puOG8rWVhGVDhDN2UxV3RxSlZvYUZkREJDdm9oSnlLMjBQS1M3L25VRzViN0o2aXEzNTE3WXZqYjREOTRMdDBkSE5TZ0QyQklJSG1Oa3BTWVdneWkxc2VhdmhONUFqdGZKcjRwMTAxdTJTc05jTEFyNDJBNWZyYW45dkwyOUhqYU0yTVRVOEwwT3hvSVg4bGdjcFV5OXdjaTdsSFFLT2l3YU9jSUtmQ0MxcU03bE81ejBjNFArbzB6VDYxODN4SlYzcm13MjJHR1lkNDBFQnFXOTdvcUJLMElqK0tsNXN1eWNaNEoycUsxYVZjaVlCWnNCTmxidG16L2s4SHVCeHk5V2JFZVBzWS82MUk1MGZCTFNBa1ZrL1RlYTRqK05OSEoxaW1wN0JvMThhTG84cGxiOWUyaVplSUR6SDF1NjZvMFJGWWJIZG5KRDhDblBlQkxWZ1N2RXFtQlMxMWZnSHI4MS90azVsSnhjS2VqZHNFZnR6R1F4d3VIdy9wamtqb2JJa3hycm9YcGE2aVhva1Z5SDRiZTE2K2YvZERhRWtoOVJmOExoMVVFUVB4eHBDeUlTTWlmSDVwTDc4REtoR25oOFZmaTdFZXNVVjFrNlkzZVZDRncyQ0NLV2N2WHNKYjlRcUxGc0RxSWxXUGg2YkJnTTRhWGZwZTBhckRyZ1lSYmJ4OEw2b3VoeXhBSHdqdHo5aTBsWGV6V01YNWY3UVlSRU1UQzV5QlBOVFRQMmZDTnNvelE9PTwvWDUwOUNlcnRpZmljYXRlPjwvWDUwOURhdGE+PC9LZXlJbmZvPjxPYmplY3Q+PGJhbmtJZFNpZ25lZERhdGEgeG1sbnM9Imh0dHA6Ly93d3cuYmFua2lkLmNvbS9zaWduYXR1cmUvdjEuMC4wL3R5cGVzIiBJZD0iYmlkU2lnbmVkRGF0YSI+PHNydkluZm8+PG5hbWU+WTI0OVJsQWdWR1Z6ZEdObGNuUWdOU3h1WVcxbFBWUmxjM1FnWVhZZ1FtRnVhMGxFTEhObGNtbGhiRTUxYldKbGNqMDFOVFkyTXpBME9USTRMRzg5VkdWemRHSmhibXNnUVNCQlFpQW9jSFZpYkNrc1l6MVRSUT09PC9uYW1lPjxub25jZT55ekJSaG4rcmNmREEvd0M1dVFMTjJxTmdnRWs9PC9ub25jZT48ZGlzcGxheU5hbWU+VkdWemRDQmhkaUJDWVc1clNVUT08L2Rpc3BsYXlOYW1lPjwvc3J2SW5mbz48Y2xpZW50SW5mbz48ZnVuY0lkPklkZW50aWZpY2F0aW9uPC9mdW5jSWQ+PHZlcnNpb24+Tnk0ek9TNHc8L3ZlcnNpb24+PGVudj48YWk+PHR5cGU+U1U5VDwvdHlwZT48ZGV2aWNlSW5mbz5NVFl1Tnk0MDwvZGV2aWNlSW5mbz48dWhpPlNVcUVTMVhFeEdaL2tOaytOOURmVkwvVmhLdz08L3VoaT48ZnNpYj4wPC9mc2liPjx1dGI+Y3MxPC91dGI+PHJlcXVpcmVtZW50Pjxjb25kaXRpb24+PHR5cGU+Q2VydGlmaWNhdGVQb2xpY2llczwvdHlwZT48dmFsdWU+MS4yLjMuNC4yNTwvdmFsdWU+PC9jb25kaXRpb24+PC9yZXF1aXJlbWVudD48dWF1dGg+cHc8L3VhdXRoPjx0b2tlbj5xci1zdGFydC10b2tlbjwvdG9rZW4+PC9haT48L2Vudj48L2NsaWVudEluZm8+PC9iYW5rSWRTaWduZWREYXRhPjwvT2JqZWN0PjwvU2lnbmF0dXJlPg==",
    ocspResponse:
      "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",
  },
  secret: "2f8f8a922095da2a1339823ea2989872256635f8",
};

interface BankIdWrapperProps {
  successComponent?: React.ComponentType<{
    identification: any;
    bankId: any;
  }> | null;
  onAuthenticated?: any;
  bankIdTitle?: string;
  bankIdDescription?: string;
  bankIdOptions?: BankIdOptions;
  debug?: boolean;
}

interface BankIdOptions {
  userVisibleData?: string;
  bankIdMethod?: "sign" | "auth";
  setBankIDSecret?: boolean;
}

export default function BankIdWrapper({
  onAuthenticated,
  bankIdDescription,
  bankIdTitle,
  successComponent: SuccessComponent = null,
  bankIdOptions = {},
  debug = false,
}: BankIdWrapperProps) {
  const bankId = useBankId(bankIdOptions);

  const {
    qrCodeImage,
    identification,
    hasError,
    hasTimedOut,
    startToken,
    autoStartToken,
    retriggerAuth,
    reset,
  } = bankId;

  const identificationStatus = useMemo(
    () => (debug ? "completed" : identification?.status),
    [identification?.status, debug]
  );

  const bankIdReducer = (state: any, action: any) => {
    switch (action.type) {
      case "SET_BANKID_DATA":
        return { ...state, ...action.payload };
      case "SET_AUTHENTICATION_METHOD":
        return { ...state, authenticationMethod: action.payload };
      default:
        return state;
    }
  };

  const initialState = {
    qrCodeImage,
    identification,
    autoStartToken,
    hasTimedOut,
    startToken,
    hasError,
    retriggerAuth,
    reset,
    authenticationMethod: "",
  };

  const identificationData = debug ? identificationDebug : identification;

  const [state, dispatch] = useReducer(bankIdReducer, initialState);
  const authenticationMethod = state?.authenticationMethod;

  console.log("authenticationMethod", authenticationMethod);

  useEffect(() => {
    dispatch({
      type: "SET_BANKID_DATA",
      payload: {
        qrCodeImage,
        identification,
        hasTimedOut,
        autoStartToken,
        startToken,
        hasError,
        authenticationMethod,
        retriggerAuth,
        reset,
      },
    });
  }, [
    qrCodeImage,
    identification,
    hasTimedOut,
    startToken,
    hasError,
    autoStartToken,
  ]);

  const openAutoStart = () => {
    dispatch({ type: "SET_AUTHENTICATION_METHOD", payload: "auto" });
    retriggerAuth();
  };

  const openQRCode = () => {
    dispatch({ type: "SET_AUTHENTICATION_METHOD", payload: "qr" });
    retriggerAuth();
  };

  useEffect(() => {
    if (identificationStatus !== "complete" || !onAuthenticated) return;

    onAuthenticated({
      identification,
      bankId,
    });
  }, [identificationStatus]);

  return (
    <BankIdContext.Provider value={{ state, dispatch }}>
      <div className="w-full">
        {identificationData?.status === "complete" && SuccessComponent && (
          <SuccessComponent
            identification={identificationData}
            bankId={bankId}
          />
        )}

        {identificationData?.status !== "complete" &&
        ["auto", "qr"].includes(authenticationMethod) ? (
          <AuthenticationView />
        ) : null}

        {identificationData?.status !== "complete" &&
        authenticationMethod === "" ? (
          <div className="flex flex-col space-y-8">
            <Button
              onClick={openQRCode}
              className="p-4 bg-blue font-semibild text-white justify-center text-md"
              borderColor="transparent"
              icon="bankid"
              iconDirection="left"
            >
              Mobilt BankID på annan enhet
            </Button>
            <Button
              className="p-4 bg-transparent font-semibild text-blue justify-center text-md"
              borderColor="blue"
              onClick={openAutoStart}
              icon="bankid"
              iconDirection="left"
            >
              BankID på denna enheten
            </Button>
          </div>
        ) : null}

        <div className="flex flex-col space-y-4 my-8">
          {bankIdTitle && <strong>{bankIdTitle}</strong>}
          {bankIdDescription && <p>{bankIdDescription}</p>}
        </div>
      </div>
    </BankIdContext.Provider>
  );
}
